# Network traffic classification: Techniques, datasets, and challenges

## 贡献
1. 对文献中部署最多的网络流量分类技术进行了全面讨论。
2. 解释所讨论技术的优点和缺点。
3. 回顾了每种技术的相关研究。
4. 强调文献中提出的解决方案的分类重点。
5. 描述研究人员在文献中部署的公共数据集。
6. 讨论所部署的技术的挑战。
7. 提供系统性调查，填补文献中其他拟议调查的空白。
8. 提供网络流量分类领域可能研究的未来方向。

## 各种技术方式
### 基于端口的识别
基于端口的识别方法，将网络流量分类到其对应协议中，例如HTTP和RTP。无论观察到的数据包数量如何，他们的经验评估提供的结果准确性不超过70%。基于端口的方法对P2P网络流量进行分类的有效性。他们的私人收集数据（包括VPN和非VPN网络流量）表明，标准端口仅占整个数据集和解决方案的30%性能较低。基于端口的分类解决方案的优势体现在其简单性上，可以实现低计算资源需求和高速分类过程。另一方面，它有两个主要缺点。首先，当今的各种应用程序都部署了伪装，即使用标准端口来交付其他协议流量，例如通过HTTP的恶意软件流量。其次，许多应用程序是随机部署的，这是指利用非标准/动态端口来交付其网络流量，例如IP电话应用程序。
### 深度包检测（DPI）
一种比特编码框架，即用于流量分类的比特级DPA签名生成。它分析网络流的前n位，提取签名并转换到状态转换机中以进行进一步比较。Hamming距离已经集成到他们的系统中，以减少冲突并增加目标应用程序的数量。
后来，同一作者引入了另一种名为BitProb的解决方案，该解决方案利用概率位签名的概念，概率位签名是从网络流中提取的n位二进制字符串长度来对网络流量进行分类。该解决方案将原始网络流量表示为网络流，并通过监视前几个数据包为每个流生成n位签名。
## 统计与机器学习
统计分类解决方案在进行网络流量分类时，依赖于统计特征提取与机器学习算法的结合。该框架的第一步是将网络流量表示为流的形式，即聚合具有相同五元组特征的数据包——包括源/目的IP地址、源/目的端口号以及TCP/UDP协议。第二步是在数据包或流层面提取统计特征。数据包层面的特征提取针对单个或聚合数据包进行，生成特征包括数据包长度和到达间隔时间；流层面的特征提取则针对整个数据流进行，生成特征包括数据包总数、总字节数和流持续时间。现有文献提出的解决方案可分为监督式机器学习分类器、无监督机器学习分类器和半监督机器学习分类器。
该矩阵中，每行对应一个应用程序的流量，每列代表一个统计特征。特征降维/选择是可选但更优的处理方式，能有效剔除冗余特征，从而提升分类器的准确率和计算资源利用率。特征选择算法主要分为两类：包装器和过滤器。
包装器通过迭代评估分类器在不同特征子集上的表现，从而确定最优特征子集。过滤器则通过分析训练数据集来筛选出不冗余且相关的特征，且无需对分类器进行任何评估。基于相关性的特征选择（CFS）采用相关性与互相关分析流程，从全部提取特征中筛选出特征子集。其中相关性分析通过量化特征与类别之间的关联度，来识别具有相关性的特征。
互相关分析通过测量特征子集中的相互关联性来识别冗余特征。最终得到的特征与定义的类别高度相关，且彼此间相关性较低。基于一致性子集搜索（CON）的特征选择算法能够识别出与同一类别具有强关联性的特征。增益比（GR）特征选择算法通过评估特征与数据集中定义类别的相关性进行排序。该算法基于信息增益（IG）算法，由于IG算法倾向于筛选具有大量取值的特征，因此能有效提升其性能。信息增益算法根据特征的熵值对数据集中的特征进行排序，具体通过计算特征在观察数据集前后类别熵值的差异来实现。卡方[32]特征选择算法则通过计算特征与类别之间的卡方统计量，根据特征与训练数据集的相关性进行排序。在提取特征并应用特征选择算法后，包含目标应用历史数据的完整数据集已就绪，可用于构建和测试分类器。具体可采用独立的训练集与测试集，或实施N折交叉验证。若采用独立训练集与测试集，需部署两个数据集分别用于分类器的构建与评估。训练阶段需要大量训练数据以确保最佳训练效果，同样地，也需要合适的测试数据集来准确评估正在构建的分类器性能。
将同一数据集同时用于训练和测试属于不良实践，因为结果可能具有误导性。此时可采用N折交叉验证法。

# “One Model Fits All Nodes”: Neuron Activation  Pattern Analysis-Based Attack Traffic Detection  Framework for P2P Networks
## 创新点
1. 推出tNeuron，这是首个能有效降低基于机器学习的流量检测在P2P网络部署时精度损失的系统。
2. 开发了一种基于Transformer的交通分类器知识提取方法，该方法可提供神经元激活模式以供分析。
3. 设计了一个模型，该模型根据Transformer模型的神经元激活模式来预测假阳性结果。
4. 推出tNeuron，这是首个能有效降低基于机器学习的流量检测在P2P网络部署时精度损失的系统。

## 研究动机
本研究的灵感源自近期关于脑细胞状态的观察发现。具体而言，神经元释放的化学物质确实能反映精神状态，特别是当疲劳导致决策失误时。基于深度学习模型中脑细胞与神经元模式的相似性，我们旨在训练一个模型，通过神经元激活模式预测交通检测模型是否在生成误报。具体来说，异常激活模式表明输入的交通样本是其他节点生成的未见过的模式，因此 DNN 模型未能充分学习该样本，生成的警报可能是误报。反之，正常激活模式则表明输入样本存在于训练数据集中且已被充分学习，此时输出的警报可信度较高。通过分析神经元激活模式来检测虚假阳性（FPs）具有挑战性，主要原因在于大多数交通检测模型要么是非 DNN 模型，要么是神经元数量有限的深度神经网络，导致可用的神经元激活信息十分有限。为解决这一问题，我们开发了一种影子模型，通过从交通模式中提取知识，为神经元激活模式分析提供丰富信息。具体而言，我们构建了一个基于Transformer编码器的模型，该模型包含大量神经元，能够基于低级交通特征（如数据包大小）预测掩码字段，从而轻松获取标签。Transformer模型具有强大的序列学习能力，其神经元激活模式能提供丰富信息。此外，我们采用无监督学习方法来学习激活模式，无需人工标注数据集即可完成任务。

## 问题的称述
保护全球 P2P 分布式网络（如 Ethereum 节点易受攻击）。使用单一节点流量训练 ML 检测模型（监督/无监督），跨节点共享部署。

## 设计目标（五点）

通用 FP 检测：适用于多种 ML 方法（监督/无监督，分析各种流量特征）。\
准确 FP 检测：不误判 TP 为 FP，避免攻击逃逸。\
实时 FP 检测：处理大规模节点海量警报，低延迟。\
鲁棒 FP 检测：保持原模型鲁棒性，对抗逃逸攻击。\
零人工成本：无需专家手动识别 FP 或访问已识别 FP（后续可用于终身学习微调）。

## tNeuron 系统设计
脑科学类比：神经元化学物质反映心理状态/决策质量。深度学习中，异常激活模式表示未见流量欠拟合，导致 FP。\
挑战：现有检测模型神经元少或非 DNN，无法提供丰富激活信息。\
解决方案：
构建 Transformer 编码器影子模型，预测掩码字段（如端口号），基于低级流量特征（包大小），易获标签，无劳动。\
无监督学习激活模式：区分异常（FP）与正常（TP）激活。\
优势：通用（独立于原检测模型）、准确/鲁棒（丰富神经元）、实时（轻量元学习）、零成本（掩码训练 + 无监督）。

## 概述
训练阶段：构建 Transformer 影子模型，提供神经元用于激活模式训练。测试阶段：对每个警报执行影子模型 + 激活模型，预测 FP。\
训练步骤（单一节点流量 {X1, y1}）：\
Token 构建：按五元组组织流，提取每包特征（到达间隔、协议号、包长），掩码端口。K-Means 聚类源/目的端口，构建标签 yT。\
Transformer 影子模型训练：堆叠双向 Transformer 编码器预测聚类标签，提取序列模式。输入所有训练流，获取全连接层激活模式 O。\
神经元激活模型训练：DBSCAN 无监督聚类 O 的激活模式，学习正常行为。

输出模型：检测模型 MD、影子模型 Mshadow、激活模型 Mactivation。\
测试阶段（新节点流量 {X2, y2}）：\
Transformer 执行：警报触发时，收集相关包，Token 化，执行 Mshadow 获激活模式（仅统计特征，如包大小/间隔，避免 spurious correlation ）。\
激活模型执行：计算激活模式与训练簇中心距离。偏差大 → 异常（FP）；否则 → 正常（TP）。\
后处理：FP 低优先级手动分析，或用于重训练。

构建过程（TokenConstruction 函数）：
Tokenize (XT 构建)：
按五元组将 X1 中的包组织成流。
提取每包特征（前 LMax 包）：
到达间隔 (arrival interval, 单位 μs)。
IANA 协议号 (protocol number)。
包长 (packet length, 字节)。

掩码端口号（mask ports，表示服务类型），作为预测目标。
XT：tokenized 数据集（LMax × 3 矩阵 per flow，剩余位置零向量）。
目的：创建序列输入，支持 Transformer 的序列学习。

标签构建 (yT)：
使用 K-Means 算法聚类 yp（源/目的端口分开聚类）：textC = KMeans(yp)  // C = {C1, ..., CK}，K 个簇中心
yi_T = arg min_j ||C_j - yi_p||^2  // 每个流分配最近簇标签
yT = [y1_T, ..., yN1_T]：N1 个流的簇标签（整数 1~K），表示端口“类型”聚类（e.g., 聚类中心代表常见服务端口组）。
目的：端口聚类提供多样、自动标签（无需手动标注），用于监督预测任务。

优势：启用 P2P 攻击检测，支持多样环境；无中心化需求。

## 实验中的应用与验证
数据集来源：真实 Ethereum 节点（8 个节点，变位置/软件/硬件，表 II）。训练于 1 个节点，测试于其他 7 个（未见流量触发 FP）。\
性能：{XT, yT} 启用影子模型减少 83.40% FP，提升 9 指标（e.g., F1 上升 7.69%-56.88%）。\
鲁棒性：预测集避免直接特征泄露，支持对抗逃逸攻击 。\
实时性：训练后，测试延迟 0.0164s，吞吐 12.82K 警报/s。
